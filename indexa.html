<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¥Ø¯Ø®Ø§Ù„ ÙˆØ¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø§Ù‚ØªØµØ§Ø¯ÙŠØ©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Ø¥Ø¶Ø§ÙØ© Ø®Ø· Ø¹Ø±Ø¨ÙŠ Ù…Ù†Ø§Ø³Ø¨ ÙŠØ¯Ø¹Ù… ØªØ§ÙŠÙ„ÙˆÙŠÙ†Ø¯ */
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap');
        body {
            font-family: 'Cairo', sans-serif;
            background-color: #f4f7f9;
        }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¬Ø¯ÙˆÙ„ */
        th, td {
            border: 1px solid #c8d9e6;
            padding: 4px;
            text-align: center;
            vertical-align: middle;
        }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø®Ù„Ø§ÙŠØ§ Ø§Ù„Ø±Ø£Ø³ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
        thead th {
            background-color: #5d98cf; /* Ù„ÙˆÙ† Ø£Ø²Ø±Ù‚ ØºØ§Ù…Ù‚ */
            color: white;
            font-weight: 700;
            font-size: 0.85rem;
            line-height: 1.2;
        }
        
        /* Ù„ÙˆÙ† Ø®Ù„ÙÙŠØ© Ø®Ù„Ø§ÙŠØ§ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ (Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ ÙØ§ØªØ­) */
        tbody td:not(:nth-child(2)):not(:nth-child(3)) {
            background-color: #ffe0c2; 
        }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¬Ø¯ÙˆÙ„ */
        .data-input {
            width: 100%;
            height: 100%;
            padding: 4px;
            border: none;
            outline: none;
            background-color: transparent;
            text-align: center;
            font-size: 0.9rem;
        }
        
        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø®Ù„Ø§ÙŠØ§ Ø§Ù„Ø«Ø§Ø¨ØªØ© (Ø§Ù„Ø³Ù„Ø¹ ÙˆØ§Ù„ÙˆØ­Ø¯Ø§Øª) */
        .fixed-cell {
            background-color: #e6f0f5 !important;
            font-weight: 600;
        }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
        .primary-btn {
            background-color: #059669; /* emerald-600 */
        }
        .primary-btn:hover {
            background-color: #047857; /* emerald-700 */
        }
        .secondary-btn {
            background-color: #3b82f6; /* blue-500 */
        }
        .secondary-btn:hover {
            background-color: #2563eb; /* blue-600 */
        }
        
        /* ØªÙ†Ø³ÙŠÙ‚ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ */
        #outputData, #reportContent {
            background-color: #fff;
            border: 1px solid #ddd;
            padding: 10px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            font-size: 0.9rem;
            line-height: 1.5;
            direction: ltr; /* Ù„ØªØ³Ù‡ÙŠÙ„ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø±Ù…ÙˆØ² ÙˆØ§Ù„Ø£Ø±Ù‚Ø§Ù… */
        }
        #reportContent {
            direction: rtl; /* Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØ¬Ø§Ù‡ Ù„Ù„ØªÙ‚Ø§Ø±ÙŠØ± */
        }
    </style>
</head>
<body class="p-4 sm:p-8">

<div id="app-container" class="max-w-7xl mx-auto bg-white shadow-xl rounded-lg p-4">
    <h1 class="text-xl sm:text-2xl font-bold text-center mb-6 text-blue-800 border-b-4 border-blue-500 pb-2">
        Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø®Ø§Ù„ ÙˆØ¹Ø±Ø¶ Ø§Ù„Ù…Ø±Ø¯ÙˆØ¯ Ø§Ù„Ø§Ù‚ØªØµØ§Ø¯ÙŠ
    </h1>

    <!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† Ø§Ù„Ø¹Ø±ÙˆØ¶ -->
    <div class="flex justify-center space-x-4 mb-6">
        <button id="showEntryBtn" class="secondary-btn text-white font-semibold py-2 px-4 rounded-lg transition duration-300">
            Ø¥Ø¯Ø®Ø§Ù„ ØªÙ‚Ø±ÙŠØ± Ø¬Ø¯ÙŠØ¯
        </button>
        <button id="showReportsBtn" class="secondary-btn text-white font-semibold py-2 px-4 rounded-lg transition duration-300">
            Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…ÙØ®Ø²Ù†Ø©
        </button>
    </div>
    
    <!-- Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ -->
    <div id="loadingIndicator" class="text-center py-4 text-blue-500 hidden">
        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 inline-block"></div>
        <p class="mt-2">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
    </div>

    <!-- 1. ÙˆØ§Ø¬Ù‡Ø© Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ) -->
    <div id="dataEntryView">
        <h2 class="text-xl font-semibold mb-4 text-gray-700">Ø¬Ø¯ÙˆÙ„ 1: Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ù‚ØªØµØ§Ø¯ÙŠØ©</h2>
        
        <div class="overflow-x-auto">
            <table id="data-table" class="min-w-full">
                <thead>
                    <tr>
                        <th rowspan="3" class="w-[3%]">Ù…</th>
                        <th rowspan="3" class="w-[10%]">Ø§Ù„Ø³Ù„Ø¹ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</th>
                        <th rowspan="3" class="w-[7%]">Ø§Ù„ÙˆØ­Ø¯Ø©</th>
                        <th colspan="7">Ø§Ù„Ø£Ø³Ø¹Ø§Ø±</th>
                        <th colspan="2">Ø²Ù…Ù† Ø§Ù„ÙˆØµÙˆÙ„ Ø§Ù„Ù‰ Ø§Ù„Ø³ÙˆÙ‚</th>
                    </tr>
                    <tr>
                        <th colspan="3">Ù‚Ø¨Ù„ Ø§Ù„ØªØ¯Ø®Ù„</th>
                        <th colspan="2">ÙØ§Ø±Ù‚ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±</th>
                        <th colspan="2">Ø¨Ø¹Ø¯ Ø§Ù„ØªØ¯Ø®Ù„</th>
                        <th rowspan="2">Ù‚Ø¨Ù„ Ø§Ù„ØªØ¯Ø®Ù„ (Ø¯Ù‚ÙŠÙ‚Ø©)</th>
                        <th rowspan="2">Ø¨Ø¹Ø¯ Ø§Ù„ØªØ¯Ø®Ù„ (Ø¯Ù‚ÙŠÙ‚Ø©)</th>
                    </tr>
                    <tr>
                        <th class="w-[7%]">Ø§Ù„Ø³Ø¹Ø± ÙÙŠ Ø£Ù‚Ø±Ø¨ Ø³ÙˆÙ‚</th>
                        <th class="w-[7%]">Ø§Ù„Ø³Ø¹Ø± ÙÙŠ Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</th>
                        <th class="w-[7%]">ÙØ§Ø±Ù‚ Ø§Ù„ØªÙƒÙ„ÙØ©</th>
                        <th class="w-[7%]">Ø§Ù„ÙØ§Ø±Ù‚ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹</th>
                        <th class="w-[7%]">ÙØ§Ø±Ù‚ Ø§Ù„ÙƒÙ„ÙØ©</th>
                        <th class="w-[7%]">Ø§Ù„Ø³Ø¹Ø± ÙÙŠ Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</th>
                        <th class="w-[7%]">Ø§Ù„Ø³Ø¹Ø± ÙÙŠ Ø£Ù‚Ø±Ø¨ Ø³ÙˆÙ‚</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³Ù„Ø¹ -->
                    <tr data-item="Ù‚Ù…Ø­"><td class="fixed-cell">1</td><td class="fixed-cell">Ù‚Ù…Ø­</td><td class="fixed-cell">ÙƒÙŠØ³</td><td><input type="number" class="data-input" data-field="Ø³Ø¹Ø±_Ø³ÙˆÙ‚_Ù‚Ø¯ÙŠÙ…"></td><td><input type="number" class="data-input" data-field="Ø³Ø¹Ø±_Ù…Ù†Ø·Ù‚Ø©_Ù‚Ø¯ÙŠÙ…"></td><td><input type="number" class="data-input" data-field="ÙØ§Ø±Ù‚_ÙƒÙ„ÙØ©_Ù‚Ø¯ÙŠÙ…"></td><td><input type="number" class="data-input" data-field="ÙØ§Ø±Ù‚_Ù…ØªÙˆÙ‚Ø¹"></td><td><input type="number" class="data-input" data-field="ÙØ§Ø±Ù‚_ÙƒÙ„ÙØ©_Ø¬Ø¯ÙŠØ¯"></td><td><input type="number" class="data-input" data-field="Ø³Ø¹Ø±_Ù…Ù†Ø·Ù‚Ø©_Ø¬Ø¯ÙŠØ¯"></td><td><input type="number" class="data-input" data-field="Ø³Ø¹Ø±_Ø³ÙˆÙ‚_Ø¬Ø¯ÙŠØ¯"></td><td><input type="number" class="data-input" data-field="Ø²Ù…Ù†_Ù‚Ø¯ÙŠÙ…"></td><td><input type="number" class="data-input" data-field="Ø²Ù…Ù†_Ø¬Ø¯ÙŠØ¯"></td></tr>
                    <tr data-item="Ø¯Ù‚ÙŠÙ‚"><td class="fixed-cell">2</td><td class="fixed-cell">Ø¯Ù‚ÙŠÙ‚</td><td class="fixed-cell">ÙƒÙŠØ³</td><td><input type="number" class="data-input" data-field="Ø³Ø¹Ø±_Ø³ÙˆÙ‚_Ù‚Ø¯ÙŠÙ…"></td><td><input type="number" class="data-input" data-field="Ø³Ø¹Ø±_Ù…Ù†Ø·Ù‚Ø©_Ù‚Ø¯ÙŠÙ…"></td><td><input type="number" class="data-input" data-field="ÙØ§Ø±Ù‚_ÙƒÙ„ÙØ©_Ù‚Ø¯ÙŠÙ…"></td><td><input type="number" class="data-input" data-field="ÙØ§Ø±Ù‚_Ù…ØªÙˆÙ‚Ø¹"></td><td><input type="number" class="data-input" data-field="ÙØ§Ø±Ù‚_ÙƒÙ„ÙØ©_Ø¬Ø¯ÙŠØ¯"></td><td><input type="number" class="data-input" data-field="Ø³Ø¹Ø±_Ù…Ù†Ø·Ù‚Ø©_Ø¬Ø¯ÙŠØ¯"></td><td><input type="number" class="data-input" data-field="Ø³Ø¹Ø±_Ø³ÙˆÙ‚_Ø¬Ø¯ÙŠØ¯"></td><td><input type="number" class="data-input" data-field="Ø²Ù…Ù†_Ù‚Ø¯ÙŠÙ…"></td><td><input type="number" class="data-input" data-field="Ø²Ù…Ù†_Ø¬Ø¯ÙŠØ¯"></td></tr>
                    <tr data-item="Ø³ÙƒØ±"><td class="fixed-cell">3</td><td class="fixed-cell">Ø³ÙƒØ±</td><td class="fixed-cell">Ù‚Ø·Ù…Ø© 10 Ùƒ</td><td><input type="number" class="data-input" data-field="Ø³Ø¹Ø±_Ø³ÙˆÙ‚_Ù‚Ø¯ÙŠÙ…"></td><td><input type="number" class="data-input" data-field="Ø³Ø¹Ø±_Ù…Ù†Ø·Ù‚Ø©_Ù‚Ø¯ÙŠÙ…"></td><td><input type="number" class="data-input" data-field="ÙØ§Ø±Ù‚_ÙƒÙ„ÙØ©_Ù‚Ø¯ÙŠÙ…"></td><td><input type="number" class="data-input" data-field="ÙØ§Ø±Ù‚_Ù…ØªÙˆÙ‚Ø¹"></td><td><input type="number" class="data-input" data-field="ÙØ§Ø±Ù‚_ÙƒÙ„ÙØ©_Ø¬Ø¯ÙŠØ¯"></td><td><input type="number" class="data-input" data-field="Ø³Ø¹Ø±_Ù…Ù†Ø·Ù‚Ø©_Ø¬Ø¯ÙŠØ¯"></td><td><input type="number" class="data-input" data-field="Ø³Ø¹Ø±_Ø³ÙˆÙ‚_Ø¬Ø¯ÙŠØ¯"></td><td><input type="number" class="data-input" data-field="Ø²Ù…Ù†_Ù‚Ø¯ÙŠÙ…"></td><td><input type="number" class="data-input" data-field="Ø²Ù…Ù†_Ø¬Ø¯ÙŠØ¯"></td></tr>
                    <tr data-item="Ø£Ø±Ø²"><td class="fixed-cell">4</td><td class="fixed-cell">Ø£Ø±Ø²</td><td class="fixed-cell">Ù‚Ø·Ù…Ø© 10 Ùƒ</td><td><input type="number" class="data-input" data-field="Ø³Ø¹Ø±_Ø³ÙˆÙ‚_Ù‚Ø¯ÙŠÙ…"></td><td><input type="number" class="data-input" data-field="Ø³Ø¹Ø±_Ù…Ù†Ø·Ù‚Ø©_Ù‚Ø¯ÙŠÙ…"></td><td><input type="number" class="data-input" data-field="ÙØ§Ø±Ù‚_ÙƒÙ„ÙØ©_Ù‚Ø¯ÙŠÙ…"></td><td><input type="number" class="data-input" data-field="ÙØ§Ø±Ù‚_Ù…ØªÙˆÙ‚Ø¹"></td><td><input type="number" class="data-input" data-field="ÙØ§Ø±Ù‚_ÙƒÙ„ÙØ©_Ø¬Ø¯ÙŠØ¯"></td><td><input type="number" class="data-input" data-field="Ø³Ø¹Ø±_Ù…Ù†Ø·Ù‚Ø©_Ø¬Ø¯ÙŠØ¯"></td><td><input type="number" class="data-input" data-field="Ø³Ø¹Ø±_Ø³ÙˆÙ‚_Ø¬Ø¯ÙŠØ¯"></td><td><input type="number" class="data-input" data-field="Ø²Ù…Ù†_Ù‚Ø¯ÙŠÙ…"></td><td><input type="number" class="data-input" data-field="Ø²Ù…Ù†_Ø¬Ø¯ÙŠØ¯"></td></tr>
                    <tr data-item="ØºØ§Ø²"><td class="fixed-cell">5</td><td class="fixed-cell">ØºØ§Ø²</td><td class="fixed-cell">Ø§Ø³Ø·ÙˆØ§Ù†Ø©</td><td><input type="number" class="data-input" data-field="Ø³Ø¹Ø±_Ø³ÙˆÙ‚_Ù‚Ø¯ÙŠÙ…"></td><td><input type="number" class="data-input" data-field="Ø³Ø¹Ø±_Ù…Ù†Ø·Ù‚Ø©_Ù‚Ø¯ÙŠÙ…"></td><td><input type="number" class="data-input" data-field="ÙØ§Ø±Ù‚_ÙƒÙ„ÙØ©_Ù‚Ø¯ÙŠÙ…"></td><td><input type="number" class="data-input" data-field="ÙØ§Ø±Ù‚_Ù…ØªÙˆÙ‚Ø¹"></td><td><input type="number" class="data-input" data-field="ÙØ§Ø±Ù‚_ÙƒÙ„ÙØ©_Ø¬Ø¯ÙŠØ¯"></td><td><input type="number" class="data-input" data-field="Ø³Ø¹Ø±_Ù…Ù†Ø·Ù‚Ø©_Ø¬Ø¯ÙŠØ¯"></td><td><input type="number" class="data-input" data-field="Ø³Ø¹Ø±_Ø³ÙˆÙ‚_Ø¬Ø¯ÙŠØ¯"></td><td><input type="number" class="data-input" data-field="Ø²Ù…Ù†_Ù‚Ø¯ÙŠÙ…"></td><td><input type="number" class="data-input" data-field="Ø²Ù…Ù†_Ø¬Ø¯ÙŠØ¯"></td></tr>
                    <tr data-item="Ù†Ù‚Ù„ Ø±Ø§ÙƒØ¨"><td class="fixed-cell">6</td><td class="fixed-cell">Ù†Ù‚Ù„ Ø±Ø§ÙƒØ¨</td><td class="fixed-cell">Ø±Ø§ÙƒØ¨</td><td><input type="number" class="data-input" data-field="Ø³Ø¹Ø±_Ø³ÙˆÙ‚_Ù‚Ø¯ÙŠÙ…"></td><td><input type="number" class="data-input" data-field="Ø³Ø¹Ø±_Ù…Ù†Ø·Ù‚Ø©_Ù‚Ø¯ÙŠÙ…"></td><td><input type="number" class="data-input" data-field="ÙØ§Ø±Ù‚_ÙƒÙ„ÙØ©_Ù‚Ø¯ÙŠÙ…"></td><td><input type="number" class="data-input" data-field="ÙØ§Ø±Ù‚_Ù…ØªÙˆÙ‚Ø¹"></td><td><input type="number" class="data-input" data-field="ÙØ§Ø±Ù‚_ÙƒÙ„ÙØ©_Ø¬Ø¯ÙŠØ¯"></td><td><input type="number" class="data-input" data-field="Ø³Ø¹Ø±_Ù…Ù†Ø·Ù‚Ø©_Ø¬Ø¯ÙŠØ¯"></td><td><input type="number" class="data-input" data-field="Ø³Ø¹Ø±_Ø³ÙˆÙ‚_Ø¬Ø¯ÙŠØ¯"></td><td><input type="number" class="data-input" data-field="Ø²Ù…Ù†_Ù‚Ø¯ÙŠÙ…"></td><td><input type="number" class="data-input" data-field="Ø²Ù…Ù†_Ø¬Ø¯ÙŠØ¯"></td></tr>
                    <tr data-item="Ù…Ø´ÙˆØ§Ø± Ø£Ø¬Ø±Ø©"><td class="fixed-cell">7</td><td class="fixed-cell">Ù…Ø´ÙˆØ§Ø± Ø£Ø¬Ø±Ø©</td><td class="fixed-cell">Ø±Ø­Ù„Ø©</td><td><input type="number" class="data-input" data-field="Ø³Ø¹Ø±_Ø³ÙˆÙ‚_Ù‚Ø¯ÙŠÙ…"></td><td><input type="number" class="data-input" data-field="Ø³Ø¹Ø±_Ù…Ù†Ø·Ù‚Ø©_Ù‚Ø¯ÙŠÙ…"></td><td><input type="number" class="data-input" data-field="ÙØ§Ø±Ù‚_ÙƒÙ„ÙØ©_Ù‚Ø¯ÙŠÙ…"></td><td><input type="number" class="data-input" data-field="ÙØ§Ø±Ù‚_Ù…ØªÙˆÙ‚Ø¹"></td><td><input type="number" class="data-input" data-field="ÙØ§Ø±Ù‚_ÙƒÙ„ÙØ©_Ø¬Ø¯ÙŠØ¯"></td><td><input type="number" class="data-input" data-field="Ø³Ø¹Ø±_Ù…Ù†Ø·Ù‚Ø©_Ø¬Ø¯ÙŠØ¯"></td><td><input type="number" class="data-input" data-field="Ø³Ø¹Ø±_Ø³ÙˆÙ‚_Ø¬Ø¯ÙŠØ¯"></td><td><input type="number" class="data-input" data-field="Ø²Ù…Ù†_Ù‚Ø¯ÙŠÙ…"></td><td><input type="number" class="data-input" data-field="Ø²Ù…Ù†_Ø¬Ø¯ÙŠØ¯"></td></tr>
                    <tr data-item="Ø£Ø³Ù…Ù†Øª"><td class="fixed-cell">8</td><td class="fixed-cell">Ø£Ø³Ù…Ù†Øª</td><td class="fixed-cell">ÙƒÙŠØ³</td><td><input type="number" class="data-input" data-field="Ø³Ø¹Ø±_Ø³ÙˆÙ‚_Ù‚Ø¯ÙŠÙ…"></td><td><input type="number" class="data-input" data-field="Ø³Ø¹Ø±_Ù…Ù†Ø·Ù‚Ø©_Ù‚Ø¯ÙŠÙ…"></td><td><input type="number" class="data-input" data-field="ÙØ§Ø±Ù‚_ÙƒÙ„ÙØ©_Ù‚Ø¯ÙŠÙ…"></td><td><input type="number" class="data-input" data-field="ÙØ§Ø±Ù‚_Ù…ØªÙˆÙ‚Ø¹"></td><td><input type="number" class="data-input" data-field="ÙØ§Ø±Ù‚_ÙƒÙ„ÙØ©_Ø¬Ø¯ÙŠØ¯"></td><td><input type="number" class="data-input" data-field="Ø³Ø¹Ø±_Ù…Ù†Ø·Ù‚Ø©_Ø¬Ø¯ÙŠØ¯"></td><td><input type="number" class="data-input" data-field="Ø³Ø¹Ø±_Ø³ÙˆÙ‚_Ø¬Ø¯ÙŠØ¯"></td><td><input type="number" class="data-input" data-field="Ø²Ù…Ù†_Ù‚Ø¯ÙŠÙ…"></td><td><input type="number" class="data-input" data-field="Ø²Ù…Ù†_Ø¬Ø¯ÙŠØ¯"></td></tr>
                    <tr data-item="Ø¯Ø¨Ø© Ø²ÙŠØª"><td class="fixed-cell">9</td><td class="fixed-cell">Ø¯Ø¨Ø© Ø²ÙŠØª</td><td class="fixed-cell">Ù„ØªØ± 4</td><td><input type="number" class="data-input" data-field="Ø³Ø¹Ø±_Ø³ÙˆÙ‚_Ù‚Ø¯ÙŠÙ…"></td><td><input type="number" class="data-input" data-field="Ø³Ø¹Ø±_Ù…Ù†Ø·Ù‚Ø©_Ù‚Ø¯ÙŠÙ…"></td><td><input type="number" class="data-input" data-field="ÙØ§Ø±Ù‚_ÙƒÙ„ÙØ©_Ù‚Ø¯ÙŠÙ…"></td><td><input type="number" class="data-input" data-field="ÙØ§Ø±Ù‚_Ù…ØªÙˆÙ‚Ø¹"></td><td><input type="number" class="data-input" data-field="ÙØ§Ø±Ù‚_ÙƒÙ„ÙØ©_Ø¬Ø¯ÙŠØ¯"></td><td><input type="number" class="data-input" data-field="Ø³Ø¹Ø±_Ù…Ù†Ø·Ù‚Ø©_Ø¬Ø¯ÙŠØ¯"></td><td><input type="number" class="data-input" data-field="Ø³Ø¹Ø±_Ø³ÙˆÙ‚_Ø¬Ø¯ÙŠØ¯"></td><td><input type="number" class="data-input" data-field="Ø²Ù…Ù†_Ù‚Ø¯ÙŠÙ…"></td><td><input type="number" class="data-input" data-field="Ø²Ù…Ù†_Ø¬Ø¯ÙŠØ¯"></td></tr>
                    <tr data-item="Ø¯ÙŠØ²Ù„"><td class="fixed-cell">10</td><td class="fixed-cell">Ø¯ÙŠØ²Ù„</td><td class="fixed-cell">Ø¯Ø¨Ø© 20 Ù„ØªØ±</td><td><input type="number" class="data-input" data-field="Ø³Ø¹Ø±_Ø³ÙˆÙ‚_Ù‚Ø¯ÙŠÙ…"></td><td><input type="number" class="data-input" data-field="Ø³Ø¹Ø±_Ù…Ù†Ø·Ù‚Ø©_Ù‚Ø¯ÙŠÙ…"></td><td><input type="number" class="data-input" data-field="ÙØ§Ø±Ù‚_ÙƒÙ„ÙØ©_Ù‚Ø¯ÙŠÙ…"></td><td><input type="number" class="data-input" data-field="ÙØ§Ø±Ù‚_Ù…ØªÙˆÙ‚Ø¹"></td><td><input type="number" class="data-input" data-field="ÙØ§Ø±Ù‚_ÙƒÙ„ÙØ©_Ø¬Ø¯ÙŠØ¯"></td><td><input type="number" class="data-input" data-field="Ø³Ø¹Ø±_Ù…Ù†Ø·Ù‚Ø©_Ø¬Ø¯ÙŠØ¯"></td><td><input type="number" class="data-input" data-field="Ø³Ø¹Ø±_Ø³ÙˆÙ‚_Ø¬Ø¯ÙŠØ¯"></td><td><input type="number" class="data-input" data-field="Ø²Ù…Ù†_Ù‚Ø¯ÙŠÙ…"></td><td><input type="number" class="data-input" data-field="Ø²Ù…Ù†_Ø¬Ø¯ÙŠØ¯"></td></tr>
                    <tr data-item="Ø¨Ù†Ø²ÙˆÙ„"><td class="fixed-cell">11</td><td class="fixed-cell">Ø¨Ù†Ø²ÙˆÙ„</td><td class="fixed-cell">Ø¯Ø¨Ø© 20 Ù„ØªØ±</td><td><input type="number" class="data-input" data-field="Ø³Ø¹Ø±_Ø³ÙˆÙ‚_Ù‚Ø¯ÙŠÙ…"></td><td><input type="number" class="data-input" data-field="Ø³Ø¹Ø±_Ù…Ù†Ø·Ù‚Ø©_Ù‚Ø¯ÙŠÙ…"></td><td><input type="number" class="data-input" data-field="ÙØ§Ø±Ù‚_ÙƒÙ„ÙØ©_Ù‚Ø¯ÙŠÙ…"></td><td><input type="number" class="data-input" data-field="ÙØ§Ø±Ù‚_Ù…ØªÙˆÙ‚Ø¹"></td><td><input type="number" class="data-input" data-field="ÙØ§Ø±Ù‚_ÙƒÙ„ÙØ©_Ø¬Ø¯ÙŠØ¯"></td><td><input type="number" class="data-input" data-field="Ø³Ø¹Ø±_Ù…Ù†Ø·Ù‚Ø©_Ø¬Ø¯ÙŠØ¯"></td><td><input type="number" class="data-input" data-field="Ø³Ø¹Ø±_Ø³ÙˆÙ‚_Ø¬Ø¯ÙŠØ¯"></td><td><input type="number" class="data-input" data-field="Ø²Ù…Ù†_Ù‚Ø¯ÙŠÙ…"></td><td><input type="number" class="data-input" data-field="Ø²Ù…Ù†_Ø¬Ø¯ÙŠØ¯"></td></tr>
                </tbody>
            </table>
        </div>

        <div class="flex justify-center mt-8">
            <button id="submitBtn" class="primary-btn text-white font-bold py-3 px-8 rounded-lg shadow-lg transition duration-300">
                Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ ÙˆØ­ÙØ¸ Ø§Ù„ØªÙ‚Ø±ÙŠØ±
            </button>
        </div>

        <!-- Ø±Ø³Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¬Ù…Ø¹Ø© ÙˆØ­Ø§Ù„Ø© Ø§Ù„Ø­ÙØ¸ -->
        <div id="outputMessage" class="mt-6 p-4 bg-gray-100 border-l-4 border-green-500 text-gray-700 rounded-md hidden">
            <h3 class="font-semibold text-lg text-green-700 mb-2">
                âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­! ÙŠÙ…ÙƒÙ† Ù†Ø³Ø® Ø§Ù„Ø±Ø³Ø§Ù„Ø©:
                <button id="copyBtn" class="mr-3 bg-blue-500 text-white text-xs font-normal py-1 px-3 rounded-md hover:bg-blue-600 transition">
                    Ù†Ø³Ø® Ø§Ù„Ù†Øµ
                </button>
            </h3>
            <pre id="outputData" class="whitespace-pre-wrap text-sm"></pre>
            <p id="copyStatus" class="mt-2 text-sm text-green-600 hidden"></p>
        </div>
    </div>

    <!-- 2. ÙˆØ§Ø¬Ù‡Ø© Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…ÙØ®Ø²Ù†Ø© (Ø§Ù„Ù‚Ø§Ù„Ø¨ Ø§Ù„Ø«Ø§Ù†ÙŠ) -->
    <div id="reportsView" class="hidden">
        <h2 class="text-xl font-semibold mb-4 text-gray-700">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø§Ù‚ØªØµØ§Ø¯ÙŠØ© Ø§Ù„Ù…ÙØ®Ø²Ù†Ø©</h2>
        
        <div id="reportsList" class="space-y-4">
            <!-- Ø³ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ù‡Ù†Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ Ù…Ù† Firestore -->
            <p id="noReports" class="text-center text-gray-500">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ‚Ø§Ø±ÙŠØ± Ù…ÙØ®Ø²Ù†Ø© Ø¨Ø¹Ø¯.</p>
        </div>
        
        <!-- ØµÙ†Ø¯ÙˆÙ‚ Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± (Modal-like) -->
        <div id="reportDetailsContainer" class="fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center p-4 z-50 hidden">
            <div class="bg-white rounded-lg p-6 w-full max-w-xl">
                <div class="flex justify-between items-center border-b pb-3 mb-4">
                    <h3 class="text-lg font-bold text-blue-700">Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</h3>
                    <button id="closeReportDetails" class="text-gray-500 hover:text-gray-800 text-2xl font-bold">&times;</button>
                </div>
                <div id="reportContent" class="bg-gray-50 border p-3 rounded-md mb-4 text-sm max-h-96 overflow-y-auto"></div>
                <button id="copyReportContentBtn" class="primary-btn text-white font-bold py-2 px-4 rounded-lg w-full transition duration-300">
                    Ù†Ø³Ø® Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªÙ‚Ø±ÙŠØ± (ÙˆØ§ØªØ³Ø§Ø¨)
                </button>
            </div>
        </div>
    </div>
</div>

<script type="module">
    // Firebase Imports
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, signInWithCustomToken, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    // Global Firebase Variables
    let app, db, auth;
    let userId = null;
    let reportsCollectionRef = null;
    let isAuthReady = false;

    // Element lookups
    const dataEntryView = document.getElementById('dataEntryView');
    const reportsView = document.getElementById('reportsView');
    const loadingIndicator = document.getElementById('loadingIndicator');
    const outputMessage = document.getElementById('outputMessage');


    // --- 1. INITIALIZATION AND AUTHENTICATION ---
    
    // ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© (Ø¶Ø±ÙˆØ±ÙŠ Ù„Ø¨ÙŠØ¦Ø© Ø§Ù„ØªØ´ØºÙŠÙ„)
    const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
    const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
    const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
    
    if (firebaseConfig) {
        app = initializeApp(firebaseConfig);
        db = getFirestore(app);
        auth = getAuth(app);
        
        // Ù…Ø³Ø§Ø± Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± (Ù„ÙƒÙŠ ÙŠØªÙ…ÙƒÙ† Ø§Ù„Ø¬Ù…ÙŠØ¹ Ù…Ù† Ø±Ø¤ÙŠØªÙ‡Ø§)
        const reportCollectionPath = `/artifacts/${appId}/public/data/economic_reports`;
        reportsCollectionRef = collection(db, reportCollectionPath);

        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
        const setupAuth = async () => {
            try {
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }
                userId = auth.currentUser?.uid || 'anonymous';
                isAuthReady = true;
                console.log("Firebase Auth Initialized. User ID:", userId);
                loadReports(); // Ø§Ø¨Ø¯Ø£ Ø¨ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø¨Ø¹Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
            } catch (error) {
                // Ù‚Ø¯ ÙŠÙƒÙˆÙ† Ø§Ù„Ø®Ø·Ø£ Ù‡Ù†Ø§ Ù‡Ùˆ Ø®Ø·Ø£ DOM Ù…Ù† loadReports Ø¥Ø°Ø§ ØªÙ… Ø§Ø³ØªØ¯Ø¹Ø§Ø¤Ù‡ Ù…Ø¨ÙƒØ±Ù‹Ø§
                console.error("Error during Firebase Auth:", error);
                isAuthReady = true; // Ø§Ø³ØªÙ…Ø± ÙÙŠ Ø§Ù„Ø¹Ù…Ù„ Ø­ØªÙ‰ Ù„Ùˆ ÙØ´Ù„ Ø§Ù„ØªØ®Ø²ÙŠÙ†
            }
        };

        setupAuth();
    } else {
        console.error("Firebase config is missing. Database features disabled.");
        isAuthReady = true;
    }
    
    // --- 2. VIEW MANAGEMENT ---
    
    function setView(viewId) {
        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¹Ù†Ø§ØµØ± Ù‚Ø¨Ù„ Ø§Ø³ØªØ®Ø¯Ø§Ù… classList
        if (dataEntryView) dataEntryView.classList.add('hidden');
        if (reportsView) reportsView.classList.add('hidden');
        if (outputMessage) outputMessage.classList.add('hidden');
        
        if (viewId === 'entry' && dataEntryView) {
            dataEntryView.classList.remove('hidden');
        } else if (viewId === 'reports' && reportsView) {
            reportsView.classList.remove('hidden');
        }
    }
    
    document.getElementById('showEntryBtn').addEventListener('click', () => setView('entry'));
    document.getElementById('showReportsBtn').addEventListener('click', () => setView('reports'));
    
    // Ø§ÙØªØ±Ø§Ø¶ÙŠÙ‹Ø§ØŒ Ø§Ø¨Ø¯Ø£ Ø¨ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
    setView('entry');

    // --- 3. DATA PROCESSING & SAVING (Firestore) ---

    // Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¬Ù…Ø¹Ø© Ø¥Ù„Ù‰ Ù†Øµ Ù…Ù†Ø³Ù‚ (Ø´ÙƒÙ„ Ø±Ø³Ø§Ù„Ø© ÙˆØ§ØªØ³Ø§Ø¨)
    function formatDataForWhatsApp(data) {
        let whatsappMessage = `ğŸ“Š *ØªÙ‚Ø±ÙŠØ± Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ù‚ØªØµØ§Ø¯ÙŠØ© (Ø¬Ø¯ÙˆÙ„ 1)* ğŸ“Š\n`;
        whatsappMessage += `*ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„:* ${new Date().toLocaleString('ar-SA')}\n\n`;
        
        // Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØªØ±ØªÙŠØ¨ Ø¹Ø±Ø¶Ù‡Ø§
        const fieldsMapping = {
            'Ø³Ø¹Ø±_Ø³ÙˆÙ‚_Ù‚Ø¯ÙŠÙ…': 'Ø§Ù„Ø³Ø¹Ø± ÙÙŠ Ø£Ù‚Ø±Ø¨ Ø³ÙˆÙ‚ (Ù‚Ø¨Ù„)',
            'Ø³Ø¹Ø±_Ù…Ù†Ø·Ù‚Ø©_Ù‚Ø¯ÙŠÙ…': 'Ø§Ù„Ø³Ø¹Ø± ÙÙŠ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© (Ù‚Ø¨Ù„)',
            'ÙØ§Ø±Ù‚_ÙƒÙ„ÙØ©_Ù‚Ø¯ÙŠÙ…': 'ÙØ§Ø±Ù‚ Ø§Ù„ØªÙƒÙ„ÙØ© (Ù‚Ø¨Ù„)',
            'ÙØ§Ø±Ù‚_Ù…ØªÙˆÙ‚Ø¹': 'Ø§Ù„ÙØ§Ø±Ù‚ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹',
            'ÙØ§Ø±Ù‚_ÙƒÙ„ÙØ©_Ø¬Ø¯ÙŠØ¯': 'ÙØ§Ø±Ù‚ Ø§Ù„ÙƒÙ„ÙØ© (Ø¨Ø¹Ø¯)',
            'Ø³Ø¹Ø±_Ù…Ù†Ø·Ù‚Ø©_Ø¬Ø¯ÙŠØ¯': 'Ø§Ù„Ø³Ø¹Ø± ÙÙŠ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© (Ø¨Ø¹Ø¯)',
            'Ø³Ø¹Ø±_Ø³ÙˆÙ‚_Ø¬Ø¯ÙŠØ¯': 'Ø§Ù„Ø³Ø¹Ø± ÙÙŠ Ø£Ù‚Ø±Ø¨ Ø³ÙˆÙ‚ (Ø¨Ø¹Ø¯)',
            'Ø²Ù…Ù†_Ù‚Ø¯ÙŠÙ…': 'Ø²Ù…Ù† Ø§Ù„ÙˆØµÙˆÙ„ (Ù‚Ø¨Ù„/Ø¯Ù‚ÙŠÙ‚Ø©)',
            'Ø²Ù…Ù†_Ø¬Ø¯ÙŠØ¯': 'Ø²Ù…Ù† Ø§Ù„ÙˆØµÙˆÙ„ (Ø¨Ø¹Ø¯/Ø¯Ù‚ÙŠÙ‚Ø©)'
        };

        data.forEach((item, index) => {
            whatsappMessage += `*${index + 1}. Ø§Ù„Ø³Ù„Ø¹Ø©: ${item['Ø§Ù„Ø³Ù„Ø¹Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©']} (${item['Ø§Ù„ÙˆØ­Ø¯Ø©']})*\n`;
            whatsappMessage += `------------------------------\n`;
            
            // ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¹Ø±Ø¶ Ù„Ù„ÙˆØ¶ÙˆØ­
            whatsappMessage += `*ğŸ’° Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ù‚Ø¨Ù„ Ø§Ù„ØªØ¯Ø®Ù„:*\n`;
            whatsappMessage += `  - ${fieldsMapping.Ø³Ø¹Ø±_Ø³ÙˆÙ‚_Ù‚Ø¯ÙŠÙ…}: ${item['Ø§Ù„Ø³Ø¹Ø± ÙÙŠ Ø£Ù‚Ø±Ø¨ Ø³ÙˆÙ‚ (Ù‚Ø¨Ù„)'] || '0'}\n`;
            whatsappMessage += `  - ${fieldsMapping.Ø³Ø¹Ø±_Ù…Ù†Ø·Ù‚Ø©_Ù‚Ø¯ÙŠÙ…}: ${item['Ø§Ù„Ø³Ø¹Ø± ÙÙŠ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© (Ù‚Ø¨Ù„)'] || '0'}\n`;
            whatsappMessage += `  - ${fieldsMapping.ÙØ§Ø±Ù‚_ÙƒÙ„ÙØ©_Ù‚Ø¯ÙŠÙ…}: ${item['ÙØ§Ø±Ù‚ Ø§Ù„ØªÙƒÙ„ÙØ© (Ù‚Ø¨Ù„)'] || '0'}\n`;

            whatsappMessage += `*ğŸ“‰ ÙÙˆØ§Ø±Ù‚ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:*\n`;
            whatsappMessage += `  - ${fieldsMapping.ÙØ§Ø±Ù‚_Ù…ØªÙˆÙ‚Ø¹}: ${item['Ø§Ù„ÙØ§Ø±Ù‚ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹'] || '0'}\n`;
            whatsappMessage += `  - ${fieldsMapping.ÙØ§Ø±Ù‚_ÙƒÙ„ÙØ©_Ø¬Ø¯ÙŠØ¯}: ${item['ÙØ§Ø±Ù‚ Ø§Ù„ÙƒÙ„ÙØ© (Ø¨Ø¹Ø¯)'] || '0'}\n`;
            
            whatsappMessage += `*ğŸ“ˆ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø¨Ø¹Ø¯ Ø§Ù„ØªØ¯Ø®Ù„:*\n`;
            whatsappMessage += `  - ${fieldsMapping.Ø³Ø¹Ø±_Ù…Ù†Ø·Ù‚Ø©_Ø¬Ø¯ÙŠØ¯}: ${item['Ø§Ù„Ø³Ø¹Ø± ÙÙŠ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© (Ø¨Ø¹Ø¯)'] || '0'}\n`;
            whatsappMessage += `  - ${fieldsMapping.Ø³Ø¹Ø±_Ø³ÙˆÙ‚_Ø¬Ø¯ÙŠØ¯}: ${item['Ø§Ù„Ø³Ø¹Ø± ÙÙŠ Ø£Ù‚Ø±Ø¨ Ø³ÙˆÙ‚ (Ø¨Ø¹Ø¯)'] || '0'}\n`;

            whatsappMessage += `*â±ï¸ Ø²Ù…Ù† Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø³ÙˆÙ‚:*\n`;
            whatsappMessage += `  - ${fieldsMapping.Ø²Ù…Ù†_Ù‚Ø¯ÙŠÙ…}: ${item['Ø²Ù…Ù† Ø§Ù„ÙˆØµÙˆÙ„ (Ù‚Ø¨Ù„/Ø¯Ù‚ÙŠÙ‚Ø©)'] || '0'}\n`;
            whatsappMessage += `  - ${fieldsMapping.Ø²Ù…Ù†_Ø¬Ø¯ÙŠØ¯}: ${item['Ø²Ù…Ù† Ø§Ù„ÙˆØµÙˆÙ„ (Ø¨Ø¹Ø¯/Ø¯Ù‚ÙŠÙ‚Ø©)'] || '0'}\n`;

            whatsappMessage += `==============================\n\n`;
        });

        whatsappMessage += `*ğŸ‘¤ Ø§Ù„Ù…ÙØ¯Ø®Ù„:* ${userId.substring(0, 8)}...\n`;
        whatsappMessage += '*âœ… Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…ÙØ¯Ø®Ù„. Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ.*';
        
        return whatsappMessage;
    }


    async function collectData() {
        if (!isAuthReady) {
            console.error("Authentication not ready. Cannot save data.");
            return; 
        }

        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ­Ù‚Ù‚ Ù‚Ø¨Ù„ Ø§Ø³ØªØ®Ø¯Ø§Ù… classList
        if (loadingIndicator) loadingIndicator.classList.remove('hidden');
        if (outputMessage) outputMessage.classList.add('hidden');

        const rows = document.querySelectorAll('#data-table tbody tr');
        const collectedData = [];
        
        const fieldsMapping = {
            'Ø³Ø¹Ø±_Ø³ÙˆÙ‚_Ù‚Ø¯ÙŠÙ…': 'Ø§Ù„Ø³Ø¹Ø± ÙÙŠ Ø£Ù‚Ø±Ø¨ Ø³ÙˆÙ‚ (Ù‚Ø¨Ù„)',
            'Ø³Ø¹Ø±_Ù…Ù†Ø·Ù‚Ø©_Ù‚Ø¯ÙŠÙ…': 'Ø§Ù„Ø³Ø¹Ø± ÙÙŠ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© (Ù‚Ø¨Ù„)',
            'ÙØ§Ø±Ù‚_ÙƒÙ„ÙØ©_Ù‚Ø¯ÙŠÙ…': 'ÙØ§Ø±Ù‚ Ø§Ù„ØªÙƒÙ„ÙØ© (Ù‚Ø¨Ù„)',
            'ÙØ§Ø±Ù‚_Ù…ØªÙˆÙ‚Ø¹': 'Ø§Ù„ÙØ§Ø±Ù‚ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹',
            'ÙØ§Ø±Ù‚_ÙƒÙ„ÙØ©_Ø¬Ø¯ÙŠØ¯': 'ÙØ§Ø±Ù‚ Ø§Ù„ÙƒÙ„ÙØ© (Ø¨Ø¹Ø¯)',
            'Ø³Ø¹Ø±_Ù…Ù†Ø·Ù‚Ø©_Ø¬Ø¯ÙŠØ¯': 'Ø§Ù„Ø³Ø¹Ø± ÙÙŠ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© (Ø¨Ø¹Ø¯)',
            'Ø³Ø¹Ø±_Ø³ÙˆÙ‚_Ø¬Ø¯ÙŠØ¯': 'Ø§Ù„Ø³Ø¹Ø± ÙÙŠ Ø£Ù‚Ø±Ø¨ Ø³ÙˆÙ‚ (Ø¨Ø¹Ø¯)',
            'Ø²Ù…Ù†_Ù‚Ø¯ÙŠÙ…': 'Ø²Ù…Ù† Ø§Ù„ÙˆØµÙˆÙ„ (Ù‚Ø¨Ù„/Ø¯Ù‚ÙŠÙ‚Ø©)',
            'Ø²Ù…Ù†_Ø¬Ø¯ÙŠØ¯': 'Ø²Ù…Ù† Ø§Ù„ÙˆØµÙˆÙ„ (Ø¨Ø¹Ø¯/Ø¯Ù‚ÙŠÙ‚Ø©)'
        };

        rows.forEach(row => {
            const item = row.getAttribute('data-item');
            const unitCell = row.querySelector('.fixed-cell:nth-child(3)');
            const itemData = { 
                'Ø§Ù„Ø³Ù„Ø¹Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©': item,
                'Ø§Ù„ÙˆØ­Ø¯Ø©': unitCell ? unitCell.textContent.trim() : 'N/A'
            };
            
            const inputs = row.querySelectorAll('.data-input');
            inputs.forEach(input => {
                const fieldKey = input.getAttribute('data-field');
                const value = input.value.trim();
                const fieldName = fieldsMapping[fieldKey] || fieldKey;
                itemData[fieldName] = value === '' ? 0 : parseFloat(value) || 0;
            });
            
            collectedData.push(itemData);
        });
        
        // 1. ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Ù†Øµ Ù…Ù†Ø³Ù‚ (Ù„Ù„ÙˆØ§ØªØ³Ø§Ø¨)
        const formattedText = formatDataForWhatsApp(collectedData);
        
        try {
            // 2. Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Firestore
            if (reportsCollectionRef) {
                await addDoc(reportsCollectionRef, {
                    reportData: collectedData,
                    whatsappContent: formattedText,
                    timestamp: serverTimestamp(),
                    userId: userId
                });
            } else {
                console.warn("Firestore not initialized. Skipping save operation.");
            }
            
            // 3. Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¬Ø§Ø­ ÙˆÙ†Øµ Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨
            const outputData = document.getElementById('outputData');
            if (outputData) outputData.textContent = formattedText;
            if (outputMessage) outputMessage.classList.remove('hidden');
            
        } catch (e) {
            console.error("Error saving document to Firestore: ", e);
            const errorMsg = document.getElementById('copyStatus');
            if (errorMsg) {
                errorMsg.textContent = 'âŒ ÙØ´Ù„ Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø±ÙŠØ± ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.';
                errorMsg.classList.remove('hidden', 'text-green-600');
                errorMsg.classList.add('text-red-600');
                setTimeout(() => errorMsg.classList.add('hidden'), 5000);
            }
        } finally {
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ­Ù‚Ù‚ Ù‚Ø¨Ù„ Ø§Ø³ØªØ®Ø¯Ø§Ù… classList
            if (loadingIndicator) loadingIndicator.classList.add('hidden');
        }
    }
    
    // --- 4. DATA LOADING (Firestore) ---

    function loadReports() {
        if (!isAuthReady || !reportsCollectionRef) {
            return; 
        }

        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ­Ù‚Ù‚ Ù‚Ø¨Ù„ Ø§Ø³ØªØ®Ø¯Ø§Ù… classList
        if (loadingIndicator) loadingIndicator.classList.remove('hidden');
        
        const reportsList = document.getElementById('reportsList');
        const noReports = document.getElementById('noReports');

        if (!reportsList) {
            if (loadingIndicator) loadingIndicator.classList.add('hidden');
            console.error("reportsList element not found.");
            return;
        }

        reportsList.innerHTML = '';
        if (noReports) noReports.classList.add('hidden');

        // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ø³ØªØ¹Ù„Ø§Ù… Ù„Ù„ØªÙ‚Ø§Ø±ÙŠØ± (Ù…Ø±ØªØ¨Ø© Ø­Ø³Ø¨ Ø§Ù„Ø£Ø­Ø¯Ø«)
        // Ù„Ø§ ØªØ³ØªØ®Ø¯Ù… orderBy("timestamp", "desc") Ù„ØªØ¬Ù†Ø¨ Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„ÙÙ‡Ø±Ø³Ø© (Index Errors) ÙÙŠ Canvas.
        // Ø³Ù†Ù‚ÙˆÙ… Ø¨Ø§Ù„ÙØ±Ø² ÙÙŠ JavaScript Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø°Ù„Ùƒ.
        const q = query(reportsCollectionRef); 
        
        // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„ØªØºÙŠÙŠØ±Ø§Øª ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„ÙØ¹Ù„ÙŠ
        onSnapshot(q, (snapshot) => {
            let reports = [];
            snapshot.docs.forEach(doc => {
                reports.push({ id: doc.id, ...doc.data() });
            });

            // Ø§Ù„ÙØ±Ø² Ù…Ø­Ù„ÙŠØ§Ù‹ ÙÙŠ JavaScript (Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹)
            reports.sort((a, b) => {
                const timeA = a.timestamp ? a.timestamp.toMillis() : 0;
                const timeB = b.timestamp ? b.timestamp.toMillis() : 0;
                return timeB - timeA;
            });
            
            reportsList.innerHTML = ''; // Ù…Ø³Ø­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            if (loadingIndicator) loadingIndicator.classList.add('hidden');
            
            if (reports.length === 0) {
                if (noReports) noReports.classList.remove('hidden');
                return;
            }
            
            reports.forEach(data => {
                const date = data.timestamp ? data.timestamp.toDate().toLocaleDateString('ar-SA') : 'N/A';
                
                const reportCard = document.createElement('div');
                reportCard.className = 'bg-white border border-gray-200 p-4 rounded-lg shadow-md flex justify-between items-center';
                reportCard.innerHTML = `
                    <div>
                        <p class="font-semibold text-gray-800">ØªÙ‚Ø±ÙŠØ± Ø¨ØªØ§Ø±ÙŠØ®: ${date}</p>
                        <p class="text-sm text-gray-500">ØªÙ… Ø¥Ø¯Ø®Ø§Ù„Ù‡ Ø¨ÙˆØ§Ø³Ø·Ø©: ${data.userId ? data.userId.substring(0, 8) + '...' : 'Ù…Ø¬Ù‡ÙˆÙ„'}</p>
                    </div>
                    <button data-report-id="${data.id}" class="view-report-btn secondary-btn text-white py-1 px-3 rounded-md transition duration-300">
                        Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„
                    </button>
                `;
                reportsList.appendChild(reportCard);
            });
            
            // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù„Ø£Ø²Ø±Ø§Ø± "Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„"
            document.querySelectorAll('.view-report-btn').forEach(button => {
                button.addEventListener('click', (e) => showReportDetails(e.target.dataset.reportId));
            });
        }, (error) => {
            console.error("Error listening to reports:", error);
            if (loadingIndicator) loadingIndicator.classList.add('hidden');
            reportsList.innerHTML = '<p class="text-center text-red-500">ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±.</p>';
        });
    }

    // --- 5. REPORT DETAILS MODAL ---

    async function showReportDetails(reportId) {
        if (!isAuthReady) return;
        
        const reportDetailsContainer = document.getElementById('reportDetailsContainer');
        const reportContent = document.getElementById('reportContent');

        if (!reportDetailsContainer || !reportContent) {
            console.error("Modal elements not found.");
            return;
        }

        reportContent.textContent = 'Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ±...';
        reportDetailsContainer.classList.remove('hidden');
        
        try {
            // Ø¨Ù…Ø§ Ø£Ù†Ù†Ø§ Ù†Ø³ØªØ®Ø¯Ù… onSnapshot Ø¨Ø¯ÙˆÙ† orderByØŒ ÙŠÙ…ÙƒÙ†Ù†Ø§ Ø¬Ù„Ø¨ Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… getDocs
            // ÙˆÙ„ÙƒÙ† Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ø§ØªØ³Ø§Ù‚ Ù…Ø¹ onSnapshot:
            
            const reportsSnapshot = await new Promise(resolve => {
                const unsubscribe = onSnapshot(query(reportsCollectionRef), (snapshot) => {
                    unsubscribe();
                    resolve(snapshot);
                });
            });

            const docFound = reportsSnapshot.docs.find(d => d.id === reportId);
            const reportData = docFound ? docFound.data() : null;

            if (reportData) {
                reportContent.textContent = reportData.whatsappContent;
            } else {
                reportContent.textContent = 'Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„ØªÙ‚Ø±ÙŠØ±.';
                console.error("Report not found:", reportId);
            }
            
        } catch(e) {
            reportContent.textContent = 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¬Ù„Ø¨ Ø§Ù„ØªÙØ§ØµÙŠÙ„.';
            console.error("Error fetching report details:", e);
        }
    }

    document.getElementById('closeReportDetails').addEventListener('click', () => {
        const reportDetailsContainer = document.getElementById('reportDetailsContainer');
        if (reportDetailsContainer) reportDetailsContainer.classList.add('hidden');
    });

    document.getElementById('copyReportContentBtn').addEventListener('click', () => {
        const reportContent = document.getElementById('reportContent');
        if (reportContent) {
            copyTextToClipboard(reportContent.textContent);
        }
    });


    // --- 6. UTILITIES (Copy function updated to be reusable) ---

    // Ø¯Ø§Ù„Ø© Ù„Ù†Ø³Ø® Ø§Ù„Ù†Øµ Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©
    function copyTextToClipboard(textToCopy) {
        const copyStatus = document.getElementById('copyStatus');
        
        // Ø§Ø³ØªØ®Ø¯Ø§Ù… execCommand Ù„Ø¶Ù…Ø§Ù† Ø§Ù„ØªÙˆØ§ÙÙ‚ÙŠØ© ÙÙŠ Ø¨ÙŠØ¦Ø§Øª Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø®ØªÙ„ÙØ©
        const textarea = document.createElement('textarea');
        textarea.value = textToCopy;
        document.body.appendChild(textarea);
        textarea.select();

        try {
            const successful = document.execCommand('copy');
            if (successful && copyStatus) {
                copyStatus.textContent = 'âœ… ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù†Øµ Ø¨Ù†Ø¬Ø§Ø­ Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©!';
                copyStatus.classList.remove('hidden', 'text-red-600');
                copyStatus.classList.add('text-green-600');
            } else if (copyStatus) {
                copyStatus.textContent = 'âŒ ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø®ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù†Ø³Ø® ÙŠØ¯ÙˆÙŠØ§Ù‹.';
                copyStatus.classList.remove('hidden', 'text-green-600');
                copyStatus.classList.add('text-red-600');
            }
        } catch (err) {
            if (copyStatus) {
                copyStatus.textContent = 'âŒ ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø®ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù†Ø³Ø® ÙŠØ¯ÙˆÙŠØ§Ù‹.';
                copyStatus.classList.remove('hidden', 'text-green-600');
                copyStatus.classList.add('text-red-600');
            }
            console.error('Copy failed:', err);
        } finally {
            document.body.removeChild(textarea);
        }
        
        // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„Ø© Ù…Ø¤Ù‚ØªÙ‹Ø§ ÙÙŠ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
        if (outputMessage) outputMessage.classList.remove('hidden');
        if (copyStatus) {
            setTimeout(() => {
                copyStatus.classList.add('hidden');
            }, 3000);
        }
    }
    
    // Ø±Ø¨Ø· Ø²Ø± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
    document.getElementById('submitBtn').addEventListener('click', collectData);
    document.getElementById('copyBtn').addEventListener('click', () => {
        const outputData = document.getElementById('outputData');
        if (outputData) {
             copyTextToClipboard(outputData.textContent);
        }
    });

</script>
</body>
</html>
